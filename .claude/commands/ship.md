---
description: Push → PR作成 → コードレビュー → マージの一連フローを実行
---

現在のブランチの変更をGitHubにシップ（出荷）してください。以下のステップを順番に実行します。

## 前提チェック

1. **ブランチ確認**: 現在のブランチが `main` かどうか確認する。
   - `main` ブランチで**未コミットの変更がある**場合:
     - `.steering/` ディレクトリから最新の作業ディレクトリを探し、ブランチ名を推定する（例: `.steering/20260228-bugfix-game-flow/` → `fix/bugfix-game-flow`）
     - `.steering/` がない場合は、変更内容から適切なブランチ名を推定する
     - ブランチを作成して切り替える: `git checkout -b <推定したブランチ名>`
     - すべての変更をステージングしてコミットする（コミットメッセージは変更内容に基づいて自動生成）
   - `main` ブランチで**変更もない**場合はエラーメッセージを出して中止する。
2. **コミット確認**: コミットされていない変更がないことを確認する。未コミットの変更がある場合はステージング・コミットをユーザーに提案する。
3. **差分確認**: `main` ブランチとの差分コミットが存在することを確認する。差分がない場合は中止する。

## ステップ1: Push

- リモートにブランチをpushする: `git push -u origin <現在のブランチ名>`
- pushに失敗した場合はエラーを表示して中止する

## ステップ2: PR作成

- `gh pr view 2>/dev/null` でPRが既に存在するか確認する
- PRが存在しない場合のみ新規作成する:
  - `git log main..HEAD` で全コミットを確認し、変更内容を把握する
  - `git diff main...HEAD` で差分全体を確認する
  - PRタイトルは70文字以内で簡潔に
  - PR本文は以下のフォーマットで作成:

```
## Summary
- 変更内容を箇条書きで記載

## Test plan
- [ ] テスト項目を記載

🤖 Generated with [Claude Code](https://claude.com/claude-code)
```

  - `gh pr create --title "タイトル" --body "..."` で作成
- PRが既に存在する場合はそのPRを使用する
- 作成したPR番号とURLをユーザーに表示する

## ステップ3: コードレビュー

- `code-reviewer` サブエージェント（Task tool, subagent_type: code-reviewer）を起動する
- レビュー対象: mainブランチとの差分すべて
- レビュー観点:
  - コード品質（命名規則、型アノテーション、GDScriptベストプラクティス）
  - セキュリティ（機密情報の漏洩、インジェクション等）
  - 設計との整合性（該当する.steeringドキュメントがあれば参照）
  - バグの可能性
- レビュー結果をユーザーに表示する

## ステップ4: マージ判断

- レビュー結果を表示した後、**必ずユーザーに確認を取る**（AskUserQuestion）:
  - 「レビュー結果を確認してください。このPRをsquash mergeしますか？」
  - 選択肢: 「マージする」/「マージしない（修正する）」
- ユーザーが承認した場合のみ:
  - `gh pr merge --squash --delete-branch` でマージ
  - `git checkout main && git pull origin main` でローカルを更新
- ユーザーが却下した場合:
  - レビューで指摘された問題点を再表示
  - 修正作業に移行できるようにする

## 注意事項

- 各ステップでエラーが発生した場合は即座に中止し、原因をユーザーに伝える
- force pushは絶対に行わない
- mainブランチへの直接pushは行わない
