# requirements.md — ビジュアルポリッシュ＋サウンド整備＋パブリッシング準備

## 概要

ゲームの「手触り」を大幅に向上させるため、ゲームフィール（ジュース）の追加、
プレースホルダー音声の実音声化、パブリッシング向けUI整備を行う。

---

## 現状の課題

### ビジュアル・ゲームフィール
- カメラシェイクがない（大ダメージ・爆発時にフィードバックなし）
- ヒットストップがない（クリティカルな攻撃の「重み」がない）
- ダメージ数字のポップアップがない（与ダメ・被ダメが視覚的にわからない）
- 画面フラッシュがない（ボスフェーズ移行・大爆発時の演出なし）
- 敵死亡時の演出が爆発パーティクルのみ（消滅アニメーションなし）
- レベルアップ時のスローモーションがない

### サウンド
- 実音声ファイルなし（`assets/sounds/` が空）
- AudioManagerが自動生成するビープ音で代用中
- BGMが完全に不在
- 武器種ごとの発射音の区別なし

### パブリッシング
- クレジット画面なし
- 設定メニューなし（音量調整・画面設定）
- チュートリアル／操作説明なし
- ゲーム統計の永続保存なし（ハイスコア等）

---

## 1. ビジュアルポリッシュ（ゲームフィール向上）

### 1.1 カメラシェイク

| トリガー | 強度 | 持続時間 |
|---------|------|---------|
| プレイヤー被弾 | 小（2-3px） | 0.15s |
| 敵撃破（通常） | 微（1px） | 0.05s |
| 爆発（W2/Bomber） | 中（4-5px） | 0.2s |
| ボス被弾 | 中（3-4px） | 0.1s |
| ボス撃破 | 大（8-10px） | 0.4s |

### 1.2 ヒットストップ（フリーズフレーム）

| トリガー | 停止時間 |
|---------|---------|
| ボスへのヒット | 30ms |
| ボス撃破 | 100ms |
| 大爆発（W2, Bomber） | 50ms |

- `Engine.time_scale` を一時的に 0.0 にし、Timer で復帰
- UI・パーティクルは `PROCESS_MODE_ALWAYS` で停止しない

### 1.3 ダメージ数字ポップアップ

- 与ダメージ：白文字、上方向にフロート＋フェードアウト（0.6s）
- クリティカル（将来対応）：大きい黄色文字
- 被ダメージ：赤文字、プレイヤー頭上
- 回復：緑文字
- フォント：Godotデフォルト、サイズ16-24px
- 同時表示上限：20個（プール管理）

### 1.4 画面フラッシュ

| トリガー | 色 | 持続時間 |
|---------|---|---------|
| ボスフェーズ移行 | 白 | 0.1s |
| ボス撃破 | 白 | 0.3s |
| プレイヤー被弾（大ダメージ） | 赤 | 0.1s |
| レベルアップ | 黄（薄） | 0.2s |

- CanvasLayer（最前面）に ColorRect を配置
- アルファ 0.3〜0.5 → 0.0 へトゥイーン

### 1.5 レベルアップ演出強化

- スローモーション：`Engine.time_scale = 0.3` を 0.5s
- 既存のパーティクルに加え、画面中央にレベル表示テキスト
- 画面フラッシュ（黄）と組み合わせ

### 1.6 敵死亡演出の強化

- 既存の爆発パーティクルに加え、スケール縮小アニメ（0.15s）
- 白フラッシュ → 縮小 → パーティクル → 消滅の順序

### 1.7 受け入れ条件（ビジュアル）

- [ ] カメラシェイクが5種類のトリガーで正しく発動する
- [ ] ヒットストップがボス戦で体感できる
- [ ] ダメージ数字が与ダメ・被ダメで表示される
- [ ] 画面フラッシュがボス撃破・レベルアップで発動する
- [ ] レベルアップ時にスローモーション演出がある
- [ ] パフォーマンスに影響しない（30FPS以上維持）

---

## 2. サウンド整備

### 2.1 SE（効果音）

プログラム生成（GDScriptでAudioStreamWAVを動的生成）で実装する。
外部ファイル不要、コード内で波形を合成。

| カテゴリ | 音名 | 波形イメージ |
|---------|------|------------|
| 武器共通 | shoot_default | 短いパルス、中高音 |
| 武器（近接） | shoot_melee | 低音スイープ＋ノイズ |
| 武器（爆発） | shoot_explosion | 低音ブーム＋残響 |
| 武器（レーザー） | shoot_laser | 高音持続＋ビブラート |
| 武器（散弾） | shoot_shotgun | ノイズバースト＋低音 |
| ヒット | hit_normal | 短い中音パルス |
| ヒット | hit_critical | 高音＋低音の重ね |
| 爆発 | explosion | 低音ノイズ＋減衰 |
| レベルアップ | levelup | 上昇音階（ド→ミ→ソ→ド） |
| アイテム取得 | pickup | 短い高音アルペジオ |
| UI | ui_click | 短いクリック音 |
| UI | ui_hover | 極短い高音 |
| プレイヤー被弾 | player_hit | 低音パルス＋ノイズ |
| 敵死亡 | enemy_death | 短い下降音 |
| ボス出現 | boss_appear | 重低音＋上昇 |
| ボス撃破 | boss_defeat | 長い上昇音＋爆発音 |
| ステージクリア | stage_clear | ファンファーレ風（和音3段） |

### 2.2 BGM

プログラム生成のシンプルなループBGMを検討。
実装が複雑すぎる場合はBGMなしでもOK（SE優先）。

| シーン | テンポ | 雰囲気 |
|-------|-------|-------|
| タイトル | 遅め（80BPM） | 静かで神秘的 |
| ゲームプレイ | 速め（140BPM） | 緊張感・疾走感 |
| ボス戦 | 速め（160BPM） | 激しさ・プレッシャー |

### 2.3 受け入れ条件（サウンド）

- [ ] 武器種ごとに異なる発射音が鳴る
- [ ] ヒット音・爆発音・レベルアップ音が区別できる
- [ ] UI操作時にクリック音が鳴る
- [ ] ボス出現・撃破に専用SEがある
- [ ] 音量が適切で耳障りでない
- [ ] 全SEがプログラム生成（外部ファイル不要）

---

## 3. パブリッシング準備

### 3.1 設定メニュー

- タイトル画面から「設定」ボタンでアクセス
- ポーズメニューからもアクセス可能
- 設定項目：
  - マスター音量（0〜100%）
  - SE音量（0〜100%）
  - BGM音量（0〜100%）
  - 画面モード（ウィンドウ／フルスクリーン）

### 3.2 操作説明画面

- タイトル画面から「操作説明」ボタンでアクセス
- 内容：
  - 移動：WASD / 矢印キー
  - スキル：スペースキー
  - ポーズ：Escキー
  - 攻撃は自動（近くの敵を自動攻撃）
  - レベルアップ時に武器・強化を選択

### 3.3 クレジット画面

- タイトル画面から「クレジット」ボタンでアクセス
- 内容：
  - ゲームタイトル
  - 開発者名
  - 使用ツール（Godot Engine 4.x）
  - 使用アセット（キャラチップ素材のクレジット等）
  - 「戻る」ボタン

### 3.4 ハイスコア保存

- ゲームオーバー／ステージクリア時にスコアを記録
- 記録項目：最長生存時間、最高レベル、最多撃破数
- `user://highscore.save` にJSON形式で保存
- タイトル画面またはゲームオーバー画面に表示

### 3.5 受け入れ条件（パブリッシング）

- [ ] 設定メニューで音量変更が反映される
- [ ] 操作説明画面が表示される
- [ ] クレジット画面が表示される
- [ ] ハイスコアがゲーム終了後も保持される
- [ ] 全画面がキーボード操作で遷移できる

---

## 4. スコープ外（今回は対応しない）

- 実音声ファイル（.ogg）の調達・差し替え（プログラム生成SEで対応）
- スプライト画像の差し替え（既存のキャラチップを継続使用）
- モバイルタッチ入力対応
- 多言語対応（日本語のみ）
- オンラインリーダーボード
- セーブ/ロード（ハイスコアのみ保存）

---

## 5. 制約事項

- 既存のAutoload構成を変更しない（新規Autoload追加は可）
- CPUParticles2Dを使用（GPU Particlesは使わない）
- 外部アセットファイルの追加は最小限（プログラム生成を優先）
- パフォーマンス：30FPS以上をデスクトップで維持
- 既存のゲームプレイバランスを変更しない
