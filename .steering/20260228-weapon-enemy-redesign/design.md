# design.md — 武器リデザイン＋敵攻撃パターン 設計書

---

## 1. 武器システム設計

### 1.1 共通アーキテクチャ

```
Weapon (Resource)          … データ定義（AttackType, パラメータ）
 └→ WeaponInstance (Node)  … 実行時の挙動（攻撃ロジック, タイマー）
     └→ Projectile (Area2D) … 弾丸（移動, 衝突, エフェクト）
```

#### AttackType 列挙型（変更後）

```gdscript
enum AttackType {
    MELEE_CIRCLE,      # 近接円範囲（マクロファージ・ブレード）
    RUSH_EXPLODE,      # 突進爆発（ニュートロ・チャージ）
    PENETRATE_LINE,    # 貫通直線（キラーTレーザー）
    SPLIT_SHOT,        # 分裂弾（抗体スプリッター）
    HOMING,            # 追尾（ナノ・ホーミング球）
    BARRIER_DOT,       # バリア型DoT+スロー（サイトカイン・リング）
    SHOTGUN,           # 近距離散弾（ファゴサイト・バースト）
    PLACE_DOT,         # 設置型DoT（インフラマ・スパイク）
}
```

#### 削除する AttackType

- `STRAIGHT_SHOT` → `PENETRATE_LINE` に統合
- `AREA_BLAST` → `MELEE_CIRCLE` に置き換え
- `PENETRATING` → `PENETRATE_LINE` に統合
- `ORBITAL` → `BARRIER_DOT` に置き換え
- `CHAIN` → 削除（代替なし）

#### Weapon Resource 追加パラメータ

```gdscript
# 分裂弾用
@export var split_count: int = 2           # 分裂数
@export var split_generation: int = 1      # 分裂段数

# バリア用
@export var barrier_radius: float = 80.0   # バリア半径
@export var slow_factor: float = 0.5       # スロー倍率（0.5 = 50%減速）
@export var dot_interval: float = 0.5      # DoTダメージ間隔

# 設置DoT用
@export var place_count: int = 1           # 設置数
@export var place_duration: float = 3.0    # 設置持続時間
@export var place_radius: float = 40.0     # 設置範囲

# 突進爆発用
@export var explosion_radius: float = 60.0 # 爆発半径
@export var rush_speed: float = 500.0      # 突進速度

# 散弾用
@export var spread_angle: float = 45.0     # 散弾の拡散角度（度）
```

---

### 1.2 武器別詳細設計

---

#### W1. マクロファージ・ブレード（近接円範囲）

**コンセプト**: プレイヤー周囲に円形の斬撃波を放つ。密着した敵を一掃する近接殲滅武器。

**動作**: 攻撃間隔ごとにプレイヤー中心に円形ダメージ判定を発生。弾丸は飛ばない。

| Lv | damage | cooldown | radius | 追加効果 |
|----|--------|----------|--------|---------|
| 1  | 20     | 1.5s     | 60px   | 単発斬撃 |
| 2  | 25     | 1.4s     | 80px   | 範囲拡大 |
| 3  | 30     | 1.3s     | 80px   | 2段攻撃（0.3s間隔で2回判定） |
| 4  | 35     | 1.2s     | 100px  | 範囲拡大 |
| 5  | 40     | 1.0s     | 120px  | 3段攻撃（0.2s間隔で3回判定） |

**実装メモ**:
- Area2Dの円形コリジョンを一瞬出して消す方式
- 弾丸（Projectile）は使わない。専用のMeleeArea（Area2D）を使用
- 多段攻撃はタイマーで複数回判定を発生

---

#### W2. ニュートロ・チャージ（突進爆発）

**コンセプト**: 高速の突進弾が最寄りの敵に向かって飛び、着弾時に爆発して範囲ダメージ。

**動作**: 最寄り敵の方向に高速弾を発射。敵に当たるか一定距離で爆発。爆発は範囲ダメージ。

| Lv | damage | cooldown | rush_speed | explosion_radius | projectile_count |
|----|--------|----------|------------|-----------------|-----------------|
| 1  | 30     | 2.5s     | 500        | 50px            | 1 |
| 2  | 35     | 2.3s     | 500        | 65px            | 1 |
| 3  | 40     | 2.3s     | 550        | 65px            | 2（同時発射） |
| 4  | 50     | 2.0s     | 600        | 80px            | 2 |
| 5  | 60     | 2.0s     | 600        | 100px           | 3（同時発射） |

**実装メモ**:
- Projectileとして発射。着弾（body_entered）時に爆発Area2Dを生成
- 爆発Area2Dは一定フレーム後に消滅
- 敵に当たらなかった場合、lifetime後に自動爆発

---

#### W3. キラーTレーザー（貫通直線）

**コンセプト**: 敵を貫通する直線ビームを発射。一列に並んだ敵をまとめて倒す。

**動作**: 最寄り敵の方向にビームを発射。ビームは敵を貫通して直進。

| Lv | damage | cooldown | speed | pierce_count | projectile_count |
|----|--------|----------|-------|-------------|-----------------|
| 1  | 15     | 1.2s     | 400   | -1（無限貫通） | 1 |
| 2  | 20     | 1.1s     | 450   | -1           | 1 |
| 3  | 20     | 1.0s     | 450   | -1           | 2（前方小角度） |
| 4  | 25     | 0.9s     | 500   | -1           | 2 |
| 5  | 30     | 0.8s     | 500   | -1           | 3（前方扇状） |

**実装メモ**:
- 既存のPENETRATING実装がベース
- Lv3以降の複数発射は前方±10度の小角度で拡散
- ビジュアルは細長いビーム状

---

#### W4. 抗体スプリッター（分裂弾）

**コンセプト**: 弾が飛んで一定距離or敵に当たると複数に分裂。広域を制圧する。

**動作**: 最寄り敵の方向に親弾を発射。親弾は一定距離（150px）飛ぶと分裂。分裂弾は放射状に広がる。

| Lv | damage | cooldown | split_count | split_generation | speed |
|----|--------|----------|-------------|-----------------|-------|
| 1  | 12     | 1.8s     | 3           | 1               | 250 |
| 2  | 14     | 1.7s     | 4           | 1               | 270 |
| 3  | 16     | 1.6s     | 4           | 2（2段分裂）     | 270 |
| 4  | 18     | 1.5s     | 5           | 2               | 300 |
| 5  | 20     | 1.4s     | 5           | 3（3段分裂）     | 300 |

**実装メモ**:
- 親弾は飛行距離150pxで自動分裂（敵hit時も分裂）
- 分裂時: 現在位置から等角度でsplit_count発の子弾を生成
- 子弾のダメージは親弾の70%（`damage * 0.7`）
- 2段分裂: 子弾がさらに100px飛ぶと再分裂（孫弾ダメージは子弾の70%）
- 分裂弾はpierceなし（1体に当たったら消える）

---

#### W5. ナノ・ホーミング球（追尾）

**コンセプト**: 敵を自動追尾する弾。確実にヒットする単体特化武器。ボス戦向き。

**動作**: 最寄り敵に向けて追尾弾を発射。緩やかにターゲットへカーブ。

| Lv | damage | cooldown | speed | homing_strength | projectile_count |
|----|--------|----------|-------|----------------|-----------------|
| 1  | 18     | 1.6s     | 200   | 0.05           | 1 |
| 2  | 22     | 1.5s     | 220   | 0.06           | 2 |
| 3  | 26     | 1.4s     | 240   | 0.07           | 3 |
| 4  | 30     | 1.3s     | 260   | 0.08           | 3 |
| 5  | 35     | 1.2s     | 280   | 0.09           | 5 |

**実装メモ**:
- 既存のHOMING実装がベース
- homing_strength = lerp係数（方向補正の強さ）
- 複数発射時は0.1s間隔でずらして発射（同時にターゲットが変わる可能性）
- ターゲットが死亡した場合、次の最寄り敵にリターゲット

---

#### W6. サイトカイン・リング（バリア型DoT+スロー）

**コンセプト**: プレイヤー周囲にバリアフィールドを展開。触れた敵は減速し継続ダメージ。

**動作**: 常時展開型。プレイヤーに追従するArea2Dバリア。バリア内の敵にdot_intervalごとにダメージ＋スロー。

| Lv | dot_damage | dot_interval | barrier_radius | slow_factor | 追加効果 |
|----|-----------|-------------|---------------|-------------|---------|
| 1  | 5         | 0.8s        | 70px          | 0.6（40%減速） | — |
| 2  | 7         | 0.7s        | 85px          | 0.55         | — |
| 3  | 9         | 0.6s        | 100px         | 0.50         | バリア可視化強化 |
| 4  | 12        | 0.5s        | 115px         | 0.45         | — |
| 5  | 15        | 0.4s        | 130px         | 0.35（65%減速） | 範囲+ビジュアル最大化 |

**実装メモ**:
- WeaponInstanceが直接Area2D（CircleShape2D）を管理
- Orbital実装を改修してバリア化
- `body_entered` / `body_exited` で敵の進入・退出を管理
- 敵のspeedを `speed * slow_factor` に変更（退出時に復元）
- dot_intervalごとにバリア内の全敵にdot_damage
- 弾丸（Projectile）は使わない

---

#### W7. ファゴサイト・バースト（近距離散弾）

**コンセプト**: 前方扇状に複数弾を一斉発射。近距離で全弾命中すれば高火力。

**動作**: プレイヤーの進行方向（停止時は最寄り敵方向）に散弾を発射。

| Lv | damage | cooldown | projectile_count | spread_angle | speed |
|----|--------|----------|-----------------|-------------|-------|
| 1  | 8      | 1.4s     | 3               | 30°         | 350 |
| 2  | 9      | 1.3s     | 5               | 35°         | 360 |
| 3  | 10     | 1.2s     | 5               | 35°         | 370（2連射 0.15s間隔） |
| 4  | 12     | 1.1s     | 7               | 40°         | 380 |
| 5  | 14     | 1.0s     | 7               | 40°         | 400（2連射 0.15s間隔） |

**実装メモ**:
- spread_angle内に均等配置して複数弾を同時発射
- 弾の射程は短い（lifetime=0.6s → 約210-240px）
- 2連射: 1回目発射後0.15sで2回目を同方向に発射
- 近距離全弾命中時のDPS: (damage × count × 連射数) / cooldown

---

#### W8. インフラマ・スパイク（設置型DoT）

**コンセプト**: 地面にダメージゾーンを設置。敵が踏むと継続ダメージ。エリア支配。

**動作**: プレイヤー周辺のランダム位置にスパイクゾーンを設置。一定時間後に消滅。

| Lv | dot_damage | tick_interval | place_count | place_duration | place_radius | cooldown |
|----|-----------|--------------|-------------|---------------|-------------|----------|
| 1  | 8         | 0.5s         | 1           | 3.0s          | 35px        | 3.0s |
| 2  | 10        | 0.5s         | 2           | 3.5s          | 40px        | 3.0s |
| 3  | 12        | 0.4s         | 2           | 4.0s          | 50px        | 2.8s |
| 4  | 15        | 0.4s         | 3           | 4.5s          | 55px        | 2.5s |
| 5  | 18        | 0.3s         | 4           | 5.0s          | 65px        | 2.5s |

**実装メモ**:
- 設置位置: プレイヤー周囲半径100-200pxのランダム位置
- Area2D + CircleShape2D で判定
- tick_intervalごとにエリア内の全敵にdot_damage
- place_duration経過で消滅（フェードアウト演出）
- 弾丸（Projectile）は使わない。専用のPlacedZone(Area2D)を新設

---

### 1.3 バランス設計サマリー

**DPS比較（Lv1時、単体対象）**

| 武器 | 単体DPS | 範囲 | ボス適性 | 雑魚適性 |
|-----|--------|------|---------|---------|
| マクロファージ・ブレード | 13.3 | 近接円 | △ | ◎ |
| ニュートロ・チャージ | 12.0 | 爆発円 | ○ | ○ |
| キラーTレーザー | 12.5 | 直線 | ○ | ◎ |
| 抗体スプリッター | 6.7+分裂 | 拡散 | △ | ◎ |
| ナノ・ホーミング球 | 11.3 | 確実単体 | ◎ | △ |
| サイトカイン・リング | 6.3/tick | バリア | △ | ○ |
| ファゴサイト・バースト | 17.1（全弾） | 前方扇 | ◎ | ○ |
| インフラマ・スパイク | 16.0/zone | 設置円 | △ | ○ |

**役割マトリクス**

```
             近距離  中距離  遠距離
  単体特化     —     —    ナノ・ホーミング球
  前方制圧     —    ファゴサイト  キラーTレーザー
  全方位     マクロファージ  ニュートロ   —
  エリア     サイトカイン  インフラマ   —
  拡散      —    抗体スプリッター  —
```

---

## 2. 敵システム設計

### 2.1 共通アーキテクチャ

```
Enemy (CharacterBody2D)         … 基底クラス（HP, 移動, 接触ダメージ）
 ├→ AIController (Resource)     … 移動AI（Chase, KeepDistance, Rush等）
 ├→ EnemyAttack (Node)          … 遠距離攻撃ロジック（Shooter, Bomber, Sniper）
 └→ EnemyVisual (Node2D)        … ビジュアル・アニメーション
```

#### 新規追加: AIController サブクラス

```gdscript
# 既存
AIChasePlayer        … プレイヤー方向に直進

# 新規
AIRush               … 一定距離まで接近→高速突進→クールダウン
AISwarmChase          … プレイヤー方向に直進（群れ用・速度にばらつき）
AIKeepDistance        … 一定距離を保つ（遠距離攻撃型用）
```

#### 新規追加: EnemyAttack クラス

```gdscript
class_name EnemyAttack extends Node

@export var attack_damage: int = 10
@export var attack_interval: float = 2.0
@export var projectile_speed: float = 200.0
@export var attack_range: float = 300.0    # この距離以内で攻撃開始

var _attack_timer: float = 0.0
var _can_attack: bool = true

func _process(delta):
    # プレイヤーが射程内にいれば攻撃
    if player_in_range() and _can_attack:
        attack()
        _can_attack = false
        _attack_timer = attack_interval

func attack() -> void:
    pass  # サブクラスでオーバーライド
```

#### 敵弾クラス

```gdscript
class_name EnemyProjectile extends Area2D

# プレイヤー弾（Projectile）とは別クラス
# コリジョンレイヤー: 敵弾専用レイヤー（プレイヤーのみに当たる）
var damage: int = 10
var speed: float = 200.0
var direction: Vector2 = Vector2.ZERO
var lifetime: float = 5.0
```

### 2.2 コリジョンレイヤー設計

| レイヤー | 用途 | マスク対象 |
|---------|------|----------|
| 1 | プレイヤー | — |
| 2 | 敵 | — |
| 3 | プレイヤー弾 | 敵(2) |
| 4 | **敵弾（新規）** | プレイヤー(1) |
| 5 | アイテム | プレイヤー(1) |
| 6 | バリア/設置物 | 敵(2) |

---

### 2.3 接触ダメージ型（3種）

---

#### E1. Charger（突進型）

**コンセプト**: プレイヤーに一定距離まで近づくと高速突進。突進後はクールダウン。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 40 |
| speed（通常） | 70.0 |
| speed（突進） | 350.0 |
| contact_damage | 15 |
| exp_value | 8 |
| rush_trigger_distance | 150px |
| rush_duration | 0.4s |
| rush_cooldown | 2.0s |

**AI: AIRush**

```
状態遷移:
  APPROACH → プレイヤー方向にspeed(70)で接近
    ↓ 距離 < 150px
  RUSH_CHARGE → 0.3s予備動作（振動 + 色変化で予告）
    ↓
  RUSHING → 突進方向を固定して350で直進（0.4s間）
    ↓
  COOLDOWN → 1.5s停止
    ↓
  APPROACH に戻る
```

**ビジュアル**:
- 通常: 丸みのある有機体、暖色系（オレンジ〜赤）
- 予告: 体が膨張＋白点滅（0.3s）
- 突進: 残像エフェクト（半透明のコピーが3つ追従）

---

#### E2. Swarm（群れ型）

**コンセプト**: 低HP・低ダメージだが大量にスポーン。物量で圧倒。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 10 |
| speed | 90.0 ± 20.0（個体差） |
| contact_damage | 3 |
| exp_value | 2 |
| spawn_group_size | 5-8体同時スポーン |

**AI: AISwarmChase**

```
- AIChasePlayerと同様にプレイヤー方向に直進
- speed にランダム±20のばらつき（群れ感を演出）
- 群れ同士の重なり回避なし（重なってOK = 処理軽量化）
```

**ビジュアル**:
- 小さめサイズ（通常敵の60%スケール）
- 緑系の丸い細菌風
- 移動時に微振動（ぶるぶる揺れる小さな雑菌感）

---

#### E3. Tank（高耐久型）

**コンセプト**: 遅いが硬い。高い接触ダメージ。壁のように迫ってくる。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 200 |
| speed | 40.0 |
| contact_damage | 25 |
| exp_value | 25 |

**AI: AIChasePlayer**（既存のまま）

```
- プレイヤー方向に低速で直進
- 特殊行動なし（シンプルな圧力）
```

**ビジュアル**:
- 大きめサイズ（通常敵の150%スケール）
- 紫〜暗赤色の膨張した有機体
- HPバー表示（他の敵と区別するため）
- 移動時に体が脈動するアニメーション

---

### 2.4 遠距離攻撃型（3種）

---

#### E4. Shooter（射撃型）

**コンセプト**: 一定距離を保ちつつ単発弾を発射する基本的な遠距離敵。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 25 |
| speed | 80.0 |
| contact_damage | 5 |
| exp_value | 7 |
| attack_damage | 8 |
| attack_interval | 2.0s |
| projectile_speed | 180.0 |
| attack_range | 250px |
| keep_distance | 180px |

**AI: AIKeepDistance**

```
- 距離 > attack_range → プレイヤー方向に接近
- 距離 < keep_distance → プレイヤーから後退
- keep_distance ≤ 距離 ≤ attack_range → 横移動（サイドステップ）
```

**攻撃: ShooterAttack**

```
- プレイヤー方向に単発の敵弾を発射
- 発射前に0.3sの予告（口元が光る演出）
- 弾は直進のみ（追尾なし）
```

**敵弾ビジュアル**:
- 小さな赤紫の有機球体（直径10px）
- 軌跡に半透明のトレイル（有機的な尾）

---

#### E5. Bomber（爆撃型）

**コンセプト**: プレイヤーの足元を狙って範囲攻撃弾を投げる。予告サークルで回避可能。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 35 |
| speed | 60.0 |
| contact_damage | 5 |
| exp_value | 10 |
| attack_damage | 15 |
| attack_interval | 3.0s |
| projectile_speed | 150.0（放物線的に飛行） |
| attack_range | 300px |
| keep_distance | 200px |
| explosion_radius | 50px |
| explosion_delay | 0.8s |

**AI: AIKeepDistance**（Shooterと同じ）

**攻撃: BomberAttack**

```
1. プレイヤーの現在位置を記録（着弾予測地点）
2. 着弾予測地点に予告サークルを表示（赤い円、0.8s）
3. 弾を発射（放物線的アニメーション: スケールを変化させて高度を表現）
4. 0.8s後に着弾予測地点で爆発（範囲ダメージ）
5. 爆発後0.5s残る残留ゾーン（DoTなし、視覚演出のみ）
```

**予告サークル**:
- 赤い半透明の円（0%→50%のアルファでフェードイン）
- 爆発タイミングに向けて収縮するリングアニメーション

**爆発ビジュアル**:
- 毒々しい緑〜黄のポップな爆発
- 小さなスプラッシュパーティクル（有機的な飛沫）

---

#### E6. Sniper（狙撃型）

**コンセプト**: 遠距離から高精度・高威力の弾を撃つ。予告線（レーザーサイト）で回避可能。

**パラメータ**

| パラメータ | 値 |
|----------|-----|
| max_hp | 20 |
| speed | 50.0 |
| contact_damage | 3 |
| exp_value | 12 |
| attack_damage | 20 |
| attack_interval | 3.5s |
| projectile_speed | 450.0 |
| attack_range | 400px |
| keep_distance | 300px |
| charge_time | 1.0s |

**AI: AIKeepDistance**（距離大きめ）

**攻撃: SniperAttack**

```
1. プレイヤー方向にエイムを開始
2. 予告線（レーザーサイト）を表示（赤い細線、1.0s間追従）
3. チャージ完了0.2s前にエイム固定（最後の位置で方向ロック）
4. 高速弾を発射
```

**予告線**:
- 赤い半透明の細線（Line2D、幅2px）
- チャージ中は明滅（0.1s間隔で点滅）
- 最後0.2sで線が太く＋不透明に（発射直前の警告）

**狙撃弾ビジュアル**:
- 細長い赤紫の高速弾（通常弾より2倍速い）
- ストレートなトレイルエフェクト

---

### 2.5 敵スポーンテーブル（改訂）

#### 構成比率（時間経過）

| 進行度 | Swarm | Charger | Tank | Shooter | Bomber | Sniper |
|-------|-------|---------|------|---------|--------|--------|
| 序盤 (0-25%) | 50% | 20% | 5% | 20% | 5% | 0% |
| 中盤前半 (25-50%) | 35% | 20% | 10% | 20% | 10% | 5% |
| 中盤後半 (50-75%) | 25% | 15% | 15% | 20% | 15% | 10% |
| 終盤 (75-100%) | 20% | 15% | 15% | 20% | 15% | 15% |

**設計意図**:
- 序盤: Swarm＋Shooter中心（基本操作に慣れる）
- 中盤: Charger/Bomberの登場で回避操作が必要に
- 終盤: 全タイプ均等＋Tank/Sniper増加で圧力最大

---

## 3. パーティクル・エフェクト設計

### 3.1 共通ルール

- **実装**: CPUParticles2D（モバイル対応）
- **最大パーティクル数**: 武器エフェクト=16個/発、敵エフェクト=8個/発
- **寿命**: 0.3-0.8s（短め、画面を埋めすぎない）
- **プレイヤー側カラー**: シアン(#00E5FF)、白(#FFFFFF)、青(#448AFF) 系（メカニック発光）
- **敵側カラー**: 赤紫(#D500F9)、赤(#FF1744)、暗緑(#76FF03→毒系) 系（有機的）

---

### 3.2 武器パーティクル

#### W1. マクロファージ・ブレード
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 攻撃時 | 円形の斬撃波リング | 白〜シアンのリング状拡散。amount=12, 円周方向に放射。0.3s |
| ヒット時 | 小さな火花 | 白い火花。amount=4, 0.15s |

#### W2. ニュートロ・チャージ
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 発射時 | マズルフラッシュ | オレンジ〜白の閃光。amount=6, 0.2s |
| 飛行中 | 軌跡 | オレンジの尾。amount=8, trail風に後方放射 |
| 爆発時 | 爆発 | 白→オレンジ→シアンのバースト。amount=16, 0.5s, 全方向放射 |

#### W3. キラーTレーザー
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 発射時 | マズルフラッシュ | シアン閃光。amount=4, 0.15s |
| 飛行中 | ビーム軌跡 | シアン〜白の直線トレイル。amount=8, 後方放射, lifetime=0.2s |
| 貫通時 | 貫通スパーク | 白い火花が貫通方向に散る。amount=6, 0.2s |

#### W4. 抗体スプリッター
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 発射時 | 小マズル | 白〜青の小閃光。amount=3, 0.15s |
| 分裂時 | 分裂バースト | 白〜水色のリングバースト。amount=8, 0.3s, 放射状 |
| ヒット時 | 小火花 | 青い火花。amount=4, 0.15s |

#### W5. ナノ・ホーミング球
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 飛行中 | 追尾トレイル | シアン〜青のスパイラル軌跡。amount=6, 後方放射, lifetime=0.3s |
| ヒット時 | 命中バースト | 白〜シアンの小爆発。amount=8, 0.3s |

#### W6. サイトカイン・リング
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 常時 | バリアフィールド | 半透明シアンの円形シールド（Canvasで描画）+ 円周上を流れる小粒子。amount=8, continuous |
| 敵接触時 | スロー＋ダメージ | 青白い放電スパーク。amount=4/tick, 0.2s |

#### W7. ファゴサイト・バースト
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 発射時 | 散弾マズル | オレンジ〜白の扇状フラッシュ。amount=8, spread_angle方向, 0.2s |
| ヒット時 | 衝撃火花 | 白い火花。amount=4, 0.15s |

#### W8. インフラマ・スパイク
| タイミング | エフェクト | パーティクル |
|----------|----------|------------|
| 設置時 | 出現フラッシュ | シアン〜白のリング。amount=6, 上方放射, 0.3s |
| 持続中 | 地面エフェクト | 半透明シアンの円形ゾーン（Canvas描画）+ 上昇する小粒子。amount=4, continuous |
| tick時 | ダメージパルス | 白いパルスリング（内→外に拡散）。amount=4, 0.2s |
| 消滅時 | フェードアウト | 粒子が散って消える。amount=6, 0.5s |

---

### 3.3 敵攻撃パーティクル

#### E1. Charger
| タイミング | エフェクト |
|----------|----------|
| 予告（0.3s） | 体が膨張＋白赤点滅 |
| 突進中 | 赤い残像（半透明コピー3つが追従、0.1s間隔で配置） |
| 突進終了 | 赤い衝撃波リング（amount=8, 0.3s） |

#### E2. Swarm
| タイミング | エフェクト |
|----------|----------|
| 移動中 | 微振動のみ（パーティクルなし = 大量スポーン時の負荷対策） |
| 死亡時 | 緑のポップな破裂（amount=4, 小さめ, 0.2s） |

#### E3. Tank
| タイミング | エフェクト |
|----------|----------|
| 移動中 | 体の脈動アニメ（スケール0.95-1.05の往復、Tween） |
| 死亡時 | 大きめの紫爆発（amount=12, 0.4s） |

#### E4. Shooter
| タイミング | エフェクト |
|----------|----------|
| 予告（0.3s） | 口元（発射点）が赤紫に発光 |
| 発射時 | 赤紫のマズルフラッシュ（amount=4, 0.15s） |
| 弾飛行中 | 赤紫のトレイル（amount=4, 後方放射, lifetime=0.2s） |
| 弾命中時 | 赤い飛沫（amount=6, 0.2s） |

#### E5. Bomber
| タイミング | エフェクト |
|----------|----------|
| 予告 | 着弾地点に赤い半透明サークル（0.8sかけてフェードイン + 収縮リング） |
| 弾飛行中 | 緑の放物線軌跡（スケール変化で高度表現） |
| 爆発時 | 毒緑〜黄のスプラッシュ爆発（amount=16, 0.5s, 放射状 + 飛沫） |
| 残留（0.5s） | 地面に毒々しい緑の残留痕（フェードアウト） |

#### E6. Sniper
| タイミング | エフェクト |
|----------|----------|
| エイム中（1.0s） | 赤い予告線（Line2D, 幅2px, 0.1s間隔で明滅） |
| 発射直前（0.2s） | 予告線が太く＋不透明に（幅4px） |
| 発射時 | 赤のマズルフラッシュ（amount=6, 0.2s） |
| 弾飛行中 | 赤いストレートトレイル（amount=6, 直線的, lifetime=0.15s） |
| 弾命中時 | 赤い衝撃波（amount=8, 0.3s） |

---

## 4. 実装上の変更点まとめ

### 4.1 変更するファイル

| ファイル | 変更内容 |
|---------|---------|
| `resources/weapon.gd` | AttackType列挙型の変更、新パラメータ追加 |
| `scripts/weapons/weapon_instance.gd` | 8種の攻撃ロジック実装 |
| `scripts/weapons/projectile.gd` | 分裂弾ロジック追加 |
| `scripts/weapons/projectile_visual.gd` | 新武器対応ビジュアル |
| `scripts/enemies/enemy.gd` | スロー対応（speed制御）、EnemyAttack子ノード対応 |
| `scripts/enemies/enemy_visual.gd` | 新敵タイプ対応 |
| `scripts/systems/enemy_spawner.gd` | 新敵のスポーンテーブル |
| `resources/ai_chase_player.gd` | 既存（変更なし） |

### 4.2 新規作成ファイル

| ファイル | 内容 |
|---------|------|
| `resources/ai_rush.gd` | 突進AI（Charger用） |
| `resources/ai_swarm_chase.gd` | 群れ追跡AI（Swarm用） |
| `resources/ai_keep_distance.gd` | 距離維持AI（遠距離敵用） |
| `scripts/enemies/enemy_attack.gd` | 敵攻撃基底クラス |
| `scripts/enemies/attacks/shooter_attack.gd` | Shooter攻撃ロジック |
| `scripts/enemies/attacks/bomber_attack.gd` | Bomber攻撃ロジック |
| `scripts/enemies/attacks/sniper_attack.gd` | Sniper攻撃ロジック |
| `scripts/weapons/melee_area.gd` | 近接円範囲攻撃判定 |
| `scripts/weapons/placed_zone.gd` | 設置型DoTゾーン |
| `scripts/weapons/enemy_projectile.gd` | 敵弾クラス |

### 4.3 削除する AttackType 対応

| 削除 | 影響 |
|------|------|
| STRAIGHT_SHOT | weapon_instance.gdの`_attack_straight_shot()`削除 |
| AREA_BLAST | weapon_instance.gdの`_attack_area_blast()`削除 |
| PENETRATING | weapon_instance.gdの`_attack_penetrating()`削除（PENETRATE_LINEに統合） |
| ORBITAL | weapon_instance.gdの`_attack_orbital()`、`_initialize_orbital_nodes()`削除 |
| CHAIN | weapon_instance.gdの`_attack_chain()`、`_deal_chain_damage()`削除 |
