# フェーズC: 新メカニクス導入 - 要求定義

**作成日**: 2026-02-27
**フェーズ**: C (New Mechanics)
**目的**: ゲームプレイに深みと戦略性を追加する新システムの導入

---

## 概要

Pattern 1: A+B完了後の次期フェーズとして、ゲームプレイを根本的に変える5つの新メカニクスを導入します。
これにより、単なる「避けて撃つ」から「戦略を立てて戦う」ゲームへと進化させます。

---

## 実装する機能

### 1. ボスバトルシステム

**ユーザーストーリー**:
> プレイヤーとして、定期的に現れる強力なボスと戦い、倒すことで特別な報酬を得たい

**受け入れ条件**:
- [ ] 3-5分ごとにボスが出現する
- [ ] ボスは画面端から警告付きで登場する
- [ ] ボスは通常敵の10倍以上のHPを持つ
- [ ] ボスは複数の攻撃パターンを持つ
- [ ] ボスを倒すと専用のドロップアイテムが出る
- [ ] ボスのHPバーが画面上部に表示される
- [ ] ボス戦中はBGMが変わる（音楽システムがある場合）

**詳細要件**:
- **ボスの種類**: 最低3種類
  - Tank Boss（耐久型）: HP 5000, 低速移動, 範囲攻撃
  - Sniper Boss（遠距離型）: HP 2000, 中速移動, 狙撃攻撃
  - Swarm Boss（召喚型）: HP 3000, 低速移動, 敵召喚
- **攻撃パターン**: 各ボス3-4種類の攻撃
- **フェーズシステム**: HP 50%以下で攻撃パターン変化
- **ドロップ**: レアアップグレード or 大量経験値オーブ

---

### 2. パワーアップアイテム（一時強化）

**ユーザーストーリー**:
> プレイヤーとして、戦闘中にランダムで現れるパワーアップアイテムを拾い、短時間の強力な効果を得たい

**受け入れ条件**:
- [ ] 30-60秒ごとにランダムな位置にパワーアップが出現する
- [ ] パワーアップは5種類以上ある
- [ ] 拾うと10-15秒間効果が持続する
- [ ] 効果時間が画面に表示される
- [ ] 複数のパワーアップを同時に持てる
- [ ] パワーアップは時間経過で消える

**パワーアップの種類**:
1. **Invincibility（無敵）** - 15秒間ダメージを受けない、黄色いオーラ
2. **Double Damage（攻撃力2倍）** - 15秒間全武器のダメージ2倍、赤いオーラ
3. **Speed Boost（移動速度2倍）** - 12秒間移動速度2倍、青い残像
4. **Magnet（磁力強化）** - 15秒間経験値オーブ吸引範囲3倍、緑のオーラ
5. **Screen Clear（画面クリア）** - 即座に画面上の全敵を撃破、金色の爆発

**詳細要件**:
- パワーアップは光るアイテムとして表示
- 拾うと専用のSEとパーティクルエフェクト
- 残り時間をUIに表示（アイコン + タイマー）
- 効果終了時にフェードアウト警告

---

### 3. プレイヤー特殊能力（アクティブスキル）

**ユーザーストーリー**:
> プレイヤーとして、クールダウン制の特殊スキルを使い、ピンチを切り抜けたい

**受け入れ条件**:
- [ ] ゲーム開始時にスキルを1つ選択できる
- [ ] スキルはキー入力（SpaceまたはShift）で発動
- [ ] 発動後にクールダウンが発生する
- [ ] クールダウン時間がUIに表示される
- [ ] スキルごとに視覚エフェクトがある

**スキルの種類**:
1. **Dash（ダッシュ）**
   - 指定方向に高速移動（無敵時間0.3秒）
   - クールダウン: 5秒
   - 距離: 150ピクセル

2. **Nova Blast（範囲攻撃）**
   - 自分中心の範囲攻撃（半径200px、ダメージ100）
   - クールダウン: 10秒
   - パーティクル: 爆発エフェクト

3. **Shield（シールド）**
   - 3秒間ダメージ無効化（青いバリア表示）
   - クールダウン: 15秒
   - 視覚: 円形シールド

4. **Time Slow（時間減速）**
   - 5秒間、敵の移動速度50%減少
   - クールダウン: 20秒
   - 視覚: 画面全体が青みがかる

**詳細要件**:
- スキル選択画面をゲーム開始前に表示
- スキルアイコンとクールダウンゲージをHUDに表示
- 使用不可時はアイコンをグレーアウト
- 発動時にSEとパーティクル

---

### 4. 環境ハザード（ステージギミック）

**ユーザーストーリー**:
> プレイヤーとして、ステージ上の危険な場所を避けながら戦いたい

**受け入れ条件**:
- [ ] ステージにランダムでハザードが出現する
- [ ] ハザードはプレイヤーと敵の両方にダメージを与える
- [ ] ハザードは視覚的に警告される（出現前に赤い円など）
- [ ] ハザードは一定時間後に消える
- [ ] 同時に複数のハザードが存在できる

**ハザードの種類**:
1. **Lava Pool（溶岩）**
   - 半径80pxの円形エリア
   - 毎秒10ダメージ
   - 持続時間: 8秒
   - 視覚: 赤い円、炎パーティクル

2. **Poison Cloud（毒の雲）**
   - 半径100pxの円形エリア
   - 毎秒5ダメージ
   - 持続時間: 12秒
   - 視覚: 緑の霧、毒パーティクル

3. **Lightning Strike（落雷）**
   - 半径50pxの円形エリア
   - 1回だけ100ダメージ
   - 警告1秒 → 着弾
   - 視覚: 黄色の警告円 → 稲妻

4. **Ice Patch（氷床）**
   - 半径90pxの円形エリア
   - ダメージなし、移動速度50%減少
   - 持続時間: 10秒
   - 視覚: 青白い円、氷パーティクル

**詳細要件**:
- 出現頻度: 15-30秒ごと
- 出現位置: プレイヤーから100px以上離れた場所
- 警告表示: 半透明の円 + パーティクル予兆
- ダメージ判定: Area2Dのoverlap検出

---

### 5. コンボシステム

**ユーザーストーリー**:
> プレイヤーとして、連続して敵を倒すことでボーナスを得たい

**受け入れ条件**:
- [ ] 敵を倒すとコンボカウントが増加する
- [ ] コンボが途切れるまでの時間は3秒
- [ ] コンボ数がHUDに大きく表示される
- [ ] コンボに応じて経験値ボーナスが増加する
- [ ] 高コンボ時に視覚エフェクトが変化する

**コンボボーナス**:
- 10コンボ: 経験値 +10%
- 20コンボ: 経験値 +20%
- 50コンボ: 経験値 +50%
- 100コンボ: 経験値 +100%

**視覚フィードバック**:
- コンボ数の表示（画面上部中央）
- コンボ10以上: 文字が金色に
- コンボ50以上: 文字が虹色に、パーティクル
- コンボ更新時: ポップアップアニメーション

**詳細要件**:
- コンボタイマーのゲージ表示
- コンボが途切れた時の演出（SEとフェードアウト）
- 最大コンボ記録をゲームオーバー画面に表示

---

## 技術要件

### パフォーマンス
- ボス出現時もFPS 60維持
- パワーアップエフェクトは軽量に（CPUParticles2D使用）
- ハザードは同時5個まで

### 互換性
- 既存のプール管理システムと統合
- 既存のアップグレードシステムと共存
- GameManager経由で状態管理

### UI/UX
- ボスHPバー: 画面上部に大きく表示
- パワーアップタイマー: 画面右上にアイコン一覧
- スキルゲージ: 画面下部中央
- コンボ表示: 画面上部中央
- ハザード警告: 明確な視覚表現

---

## 制約事項

1. **スコープ制限**
   - ボスは3種類まで
   - パワーアップは5種類まで
   - スキルは4種類まで
   - ハザードは4種類まで

2. **技術制約**
   - 既存のオブジェクトプーリングを維持
   - CPUParticles2Dのみ使用（GPUは使わない）
   - シェーダーは使わない（シンプルなエフェクトのみ）

3. **アセット制約**
   - スプライトは引き続きColorRect仮表示
   - SEは既存のビープ音を拡張（新しい周波数）
   - BGM切り替えは後回し（Phase Bで対応）

---

## 成功の定義

- [ ] ボスが出現し、倒すことができる
- [ ] パワーアップを拾って効果を実感できる
- [ ] スキルを使ってピンチを切り抜けられる
- [ ] ハザードを避けながら戦う戦略性が生まれる
- [ ] コンボを繋げることで爽快感が増す
- [ ] 全ての新メカニクスが既存システムと共存している
- [ ] FPS 60を維持している

---

## 次のステップ

この要求定義が承認されたら、`design.md`で実装設計を行います。

---

## 関連ドキュメント

- **[アセット仕様書](../../docs/asset-specifications.md)** - 全ゲームアセットの詳細仕様
  - キャラクター・敵・ボスのスプライトサイズと命名規則
  - エフェクト・パーティクルの仕様
  - UI素材の9-slice設定とサイズ
  - BGM/SEのフォーマットとループ設定
  - Godotインポート設定とピクセルアート運用方針
